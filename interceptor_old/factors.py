'''
HEADERS
'''
# AWT
{'accept-language': 'en-US,en;q=0.5', 'accept-encoding': 'gzip, deflate', 'connection': 'keep-alive', 'accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8', 'user-agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10.10; rv:35.0) Gecko/20100101 Firefox/35.0', 'dnt': '1', 'host': 'localhost:9196', 'cookie': 'ci_session=a%3A5%3A%7Bs%3A10%3A%22session_id%22%3Bs%3A32%3A%223723f82fda5ce1253fa31d603a0365d6%22%3Bs%3A10%3A%22ip_address%22%3Bs%3A9%3A%22127.0.0.1%22%3Bs%3A10%3A%22user_agent%22%3Bs%3A82%3A%22Mozilla%2F5.0+%28Macintosh%3B+Intel+Mac+OS+X+10.10%3B+rv%3A35.0%29+Gecko%2F20100101+Firefox%2F35.0%22%3Bs%3A13%3A%22last_activity%22%3Bi%3A1421469520%3Bs%3A9%3A%22user_data%22%3Bs%3A0%3A%22%22%3B%7Dc791580eb7875cd617c68c4606a1964ccd9b7534'}
{'accept-language': 'en-US,en;q=0.5', 'accept-encoding': 'gzip, deflate', 'cache-control': 'max-age=0', 'connection': 'keep-alive', 'accept': 'text/css,*/*;q=0.1', 'user-agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10.10; rv:35.0) Gecko/20100101 Firefox/35.0', 'dnt': '1', 'host': 'localhost:9196', 'referer': 'http://localhost:9196/awt/', 'if-modified-since': 'Mon, 05 Jan 2015 15:18:29 GMT', 'cookie': 'ci_session=a%3A5%3A%7Bs%3A10%3A%22session_id%22%3Bs%3A32%3A%223723f82fda5ce1253fa31d603a0365d6%22%3Bs%3A10%3A%22ip_address%22%3Bs%3A9%3A%22127.0.0.1%22%3Bs%3A10%3A%22user_agent%22%3Bs%3A82%3A%22Mozilla%2F5.0+%28Macintosh%3B+Intel+Mac+OS+X+10.10%3B+rv%3A35.0%29+Gecko%2F20100101+Firefox%2F35.0%22%3Bs%3A13%3A%22last_activity%22%3Bi%3A1421469520%3Bs%3A9%3A%22user_data%22%3Bs%3A0%3A%22%22%3B%7Dc791580eb7875cd617c68c4606a1964ccd9b7534', 'if-none-match': '"24aa0-50be933dd9b40"'}

# INVOICE
{'accept-language': 'en-US,en;q=0.5', 'accept-encoding': 'gzip, deflate', 'connection': 'keep-alive', 'accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8', 'user-agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10.10; rv:35.0) Gecko/20100101 Firefox/35.0', 'dnt': '1', 'host': 'localhost:9196', 'cookie': 'ci_session=a%3A5%3A%7Bs%3A10%3A%22session_id%22%3Bs%3A32%3A%223723f82fda5ce1253fa31d603a0365d6%22%3Bs%3A10%3A%22ip_address%22%3Bs%3A9%3A%22127.0.0.1%22%3Bs%3A10%3A%22user_agent%22%3Bs%3A82%3A%22Mozilla%2F5.0+%28Macintosh%3B+Intel+Mac+OS+X+10.10%3B+rv%3A35.0%29+Gecko%2F20100101+Firefox%2F35.0%22%3Bs%3A13%3A%22last_activity%22%3Bi%3A1421469520%3Bs%3A9%3A%22user_data%22%3Bs%3A0%3A%22%22%3B%7Dc791580eb7875cd617c68c4606a1964ccd9b7534'}

# XAMPP
{'accept-language': 'en-US,en;q=0.5', 'accept-encoding': 'gzip, deflate', 'connection': 'keep-alive', 'accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8', 'user-agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10.10; rv:35.0) Gecko/20100101 Firefox/35.0', 'dnt': '1', 'host': 'localhost:9196', 'cookie': 'ci_session=a%3A5%3A%7Bs%3A10%3A%22session_id%22%3Bs%3A32%3A%223723f82fda5ce1253fa31d603a0365d6%22%3Bs%3A10%3A%22ip_address%22%3Bs%3A9%3A%22127.0.0.1%22%3Bs%3A10%3A%22user_agent%22%3Bs%3A82%3A%22Mozilla%2F5.0+%28Macintosh%3B+Intel+Mac+OS+X+10.10%3B+rv%3A35.0%29+Gecko%2F20100101+Firefox%2F35.0%22%3Bs%3A13%3A%22last_activity%22%3Bi%3A1421469520%3Bs%3A9%3A%22user_data%22%3Bs%3A0%3A%22%22%3B%7Dc791580eb7875cd617c68c4606a1964ccd9b7534; sim_csrf_cookie_sim=72d81b96f8fb6673774f66b22861e2f8; sim_sim_session=a%3A5%3A%7Bs%3A10%3A%22session_id%22%3Bs%3A32%3A%22b07c263953a2a355906a75d323ceb1a5%22%3Bs%3A10%3A%22ip_address%22%3Bs%3A9%3A%22127.0.0.1%22%3Bs%3A10%3A%22user_agent%22%3Bs%3A82%3A%22Mozilla%2F5.0+%28Macintosh%3B+Intel+Mac+OS+X+10.10%3B+rv%3A35.0%29+Gecko%2F20100101+Firefox%2F35.0%22%3Bs%3A13%3A%22last_activity%22%3Bi%3A1421469658%3Bs%3A9%3A%22user_data%22%3Bs%3A0%3A%22%22%3B%7Df1f370c423471fb746de3b5ff0da2dd3'}

{'accept-language': 'en-US,en;q=0.5', 'accept-encoding': 'gzip, deflate', 'connection': 'keep-alive', 'accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8', 'user-agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10.10; rv:35.0) Gecko/20100101 Firefox/35.0', 'dnt': '1', 'host': 'localhost:9196', 'referer': 'http://localhost:9196/xampp/guestbook-en.pl', 'cookie': 'ci_session=a%3A5%3A%7Bs%3A10%3A%22session_id%22%3Bs%3A32%3A%223723f82fda5ce1253fa31d603a0365d6%22%3Bs%3A10%3A%22ip_address%22%3Bs%3A9%3A%22127.0.0.1%22%3Bs%3A10%3A%22user_agent%22%3Bs%3A82%3A%22Mozilla%2F5.0+%28Macintosh%3B+Intel+Mac+OS+X+10.10%3B+rv%3A35.0%29+Gecko%2F20100101+Firefox%2F35.0%22%3Bs%3A13%3A%22last_activity%22%3Bi%3A1421469520%3Bs%3A9%3A%22user_data%22%3Bs%3A0%3A%22%22%3B%7Dc791580eb7875cd617c68c4606a1964ccd9b7534; sim_csrf_cookie_sim=72d81b96f8fb6673774f66b22861e2f8; sim_sim_session=a%3A5%3A%7Bs%3A10%3A%22session_id%22%3Bs%3A32%3A%22b07c263953a2a355906a75d323ceb1a5%22%3Bs%3A10%3A%22ip_address%22%3Bs%3A9%3A%22127.0.0.1%22%3Bs%3A10%3A%22user_agent%22%3Bs%3A82%3A%22Mozilla%2F5.0+%28Macintosh%3B+Intel+Mac+OS+X+10.10%3B+rv%3A35.0%29+Gecko%2F20100101+Firefox%2F35.0%22%3Bs%3A13%3A%22last_activity%22%3Bi%3A1421469658%3Bs%3A9%3A%22user_data%22%3Bs%3A0%3A%22%22%3B%7Df1f370c423471fb746de3b5ff0da2dd3'}


'''
Other Data
'''

# possible responsses
{'requestline': 'HTTP/1.1 200 OK', 'error_message': "Bad request version ('OK')", 'raw_requestline': 'HTTP/1.1 200 OK\r\n', 'command': None, 'rfile': <StringIO.StringIO instance at 0x101fb0b48>, 'error_code': 400, 'request_version': 'HTTP/0.9', 'close_connection': 1}
{'requestline': 'HTTP/1.1 200 OK', 'error_message': "Bad request version ('OK')", 'raw_requestline': 'HTTP/1.1 200 OK\r\n', 'command': None, 'rfile': <StringIO.StringIO instance at 0x101fb00e0>, 'error_code': 400, 'request_version': 'HTTP/0.9', 'close_connection': 1}
{'requestline': 'HTTP/1.1 404 Not Found', 'error_message': "Bad request syntax ('HTTP/1.1 404 Not Found')", 'raw_requestline': 'HTTP/1.1 404 Not Found\r\n', 'command': None, 'rfile': <StringIO.StringIO instance at 0x101fad998>, 'error_code': 400, 'request_version': 'HTTP/0.9', 'close_connection': 1}
{'requestline': 'HTTP/1.1 304 Not Modified', 'error_message': "Bad request syntax ('HTTP/1.1 304 Not Modified')", 'raw_requestline': 'HTTP/1.1 304 Not Modified\r\n', 'command': None, 'rfile': <StringIO.StringIO instance at 0x101fb0c20>, 'error_code': 400, 'request_version': 'HTTP/0.9', 'close_connection': 1}
{'requestline': 'HTTP/1.1 304 Not Modified', 'error_message': "Bad request syntax ('HTTP/1.1 304 Not Modified')", 'raw_requestline': 'HTTP/1.1 304 Not Modified\r\n', 'command': None, 'rfile': <StringIO.StringIO instance at 0x101fb25a8>, 'error_code': 400, 'request_version': 'HTTP/0.9', 'close_connection': 1}




# possible requests
{'requestline': 'GET /xampp/guestbook-en.pl HTTP/1.1', 'error_message': None, 'raw_requestline': 'GET /xampp/guestbook-en.pl HTTP/1.1\r\n', 'headers': <mimetools.Message instance at 0x101fb00e0>, 'command': 'GET', 'rfile': <StringIO.StringIO instance at 0x101fb0b90>, 'path': '/xampp/guestbook-en.pl', 'error_code': None, 'request_version': 'HTTP/1.1', 'close_connection': 1}
{'requestline': 'GET /xampp/guestbook-en.pl?f_name=new+thang&f_email=djkjsdfjskfjd&f_text=sdflsdfj4343434 HTTP/1.1', 'error_message': None, 'raw_requestline': 'GET /xampp/guestbook-en.pl?f_name=new+thang&f_email=djkjsdfjskfjd&f_text=sdflsdfj4343434 HTTP/1.1\r\n', 'headers': <mimetools.Message instance at 0x101fb0bd8>, 'command': 'GET', 'rfile': <StringIO.StringIO instance at 0x101fb0098>, 'path': '/xampp/guestbook-en.pl?f_name=new+thang&f_email=djkjsdfjskfjd&f_text=sdflsdfj4343434', 'error_code': None, 'request_version': 'HTTP/1.1', 'close_connection': 1}
{'requestline': 'PUT /awt/question/vote_down/13 HTTP/1.1', 'error_message': None, 'raw_requestline': 'PUT /awt/question/vote_down/13 HTTP/1.1\r\n', 'headers': <mimetools.Message instance at 0x101fb0128>, 'command': 'PUT', 'rfile': <StringIO.StringIO instance at 0x101fb0b90>, 'path': '/awt/question/vote_down/13', 'error_code': None, 'request_version': 'HTTP/1.1', 'close_connection': 1}
{'requestline': 'PUT /awt/answer/rate/17/4 HTTP/1.1', 'error_message': None, 'raw_requestline': 'PUT /awt/answer/rate/17/4 HTTP/1.1\r\n', 'headers': <mimetools.Message instance at 0x101fb0d88>, 'command': 'PUT', 'rfile': <StringIO.StringIO instance at 0x101fad998>, 'path': '/awt/answer/rate/17/4', 'error_code': None, 'request_version': 'HTTP/1.1', 'close_connection': 1}
{'requestline': 'POST /awt/answer/update/ HTTP/1.1', 'error_message': None, 'raw_requestline': 'POST /awt/answer/update/ HTTP/1.1\r\n', 'headers': <mimetools.Message instance at 0x101fb0b00>, 'command': 'POST', 'rfile': <StringIO.StringIO instance at 0x101faffc8>, 'path': '/awt/answer/update/', 'error_code': None, 'request_version': 'HTTP/1.1', 'close_connection': 1}
{'requestline': 'GET /awt/answer/delete/17 HTTP/1.1', 'error_message': None, 'raw_requestline': 'GET /awt/answer/delete/17 HTTP/1.1\r\n', 'headers': <mimetools.Message instance at 0x101fb0050>, 'command': 'GET', 'rfile': <StringIO.StringIO instance at 0x101fb00e0>, 'path': '/awt/answer/delete/17', 'error_code': None, 'request_version': 'HTTP/1.1', 'close_connection': 1}



{'headers': <mimetools.Message instance at 0x101fb0050>, 'rfile': <StringIO.StringIO instance at 0x101fb00e0>, 'request_version': 'HTTP/1.1'}

{'rfile': <StringIO.StringIO instance at 0x101fb25a8>}




requestline = {
    # requests
    'PUT /awt/answer/rate/17/4 HTTP/1.1',
    'POST /awt/answer/update/ HTTP/1.1',
    'GET /awt/answer/delete/17 HTTP/1.1',
    'GET /xampp/guestbook-en.pl?f_name=new+thang&f_email=djkjsdfjskfjd&f_text=sdflsdfj4343434 HTTP/1.1',
    'GET /xampp/guestbook-en.pl HTTP/1.1',

    # responses
    'HTTP/1.1 200 OK',
    'HTTP/1.1 302 Found',
    'HTTP/1.1 304 Not Modified',
    'HTTP/1.1 404 Not Found'
}

error_message = {
    # requests
    None,
    None,
    None,

    # responses
    "Bad request version ('OK')",
    "Bad request syntax ('HTTP/1.1 404 Not Found')",
    "Bad request syntax ('HTTP/1.1 304 Not Modified')"
}


command = {
    # requests
    'PUT',
    'GET',
    'POST',

    # responses
    None,
    None,
    None,
}

path = {
    # requests
    '/awt/answer/delete/17',
    '/awt/answer/update/',
    '/xampp/guestbook-en.pl'


    # responses
    # no path here
}

close_connection = {
    # requests
    1,
    1,
    1,

    # responses
    1,
    1
}

error_code = {
    # requests
    None,
    None,
    None,

    # responses
    400,
    400,
    400
}

protocol_version = {
    'HTTP/1.0'
}

# request_version seems to be different than protocol version
request_version = {
    'HTTP/1.1'
}


parts = [
    r'(?P<host>\S+)',                   # host %h
    r'(?P<user>\S+)',                   # user %u
    r'\[(?P<day>\S{2})\/(?P<month>\S{3})\/(?P<year>\S{4}):(?P<time>.+)\s.+\]',                # time %t
    r'"(?P<request>.+)"',               # request "%r"
    r'(?P<protocol>.*)',               # protocol "%{Protocol}i"
    r'(?P<referer>.*)',               # referer "%{Referer}i"
    r'(?P<status>[0-9]+)',              # status %>s
    r'(?P<size>\S+)',                   # size %b (careful, can be '-')
    r'"(?P<agent>.*)"',                 # user agent "%{User-agent}i"
    r'(?P<hit>\S+)',               # hit "%{Hit}i"
    r'(?P<type>\S+)',               # type "%{Type}i"
    r'\S+',                             # indent %l (unused)
    r'(?P<unused1>.*)',               # unused1 "%{unused1}i"
    r'(?P<unused2>.*)',               # unused2 "%{Unused2}i"
]


NORMAL_HTTP_METHODS = ["GET", "HEAD", "POST"]
VALID_HTTP_METHODS = ["OPTIONS", "GET", "HEAD", "POST", "PUT", "DELETE", "TRACE", "CONNECT", "PROPFIND", "PROPPATCH", "MKCOL", "COPY", "MOVE", "LOCK", "UNLOCK", "VERSION-CONTROL", "REPORT", "CHECKOUT", "CHECKIN", "UNCHECKOUT", "MKWORKSPACE", "UPDATE", "LABEL", "MERGE", "BASELINE-CONTROL", "MKACTIVITY", "ORDERPATCH", "ACL"]


res["http_ver"] = res["request"].split()[-1]
    res["method"] = res["request"].split()[0]
    res["request"] = res["request"].split()[-2]




    if res["size"] == "-":
        res["size"] = 0
    else:
        res["size"] = int(res["size"])

    #just to observe the illogically large sizes
    if (res["size"] >= UNREASANABLE_SIZE):
        print "unreasonably large payload ", line
        return None

    if res["referer"] == "-":
        res["referer"] = None

    res["time"] = res["year"]+'-'+months[res["month"]]+'-'+res["day"] + "T" + res["time"]+"Z"
